{"ast":null,"code":"import * as d3 from 'd3';\nimport * as $ from \"jquery\";\nimport * as helpers from './utils/helpers.js';\n\nd3.selection.prototype.moveToFront = function () {\n  return this.each(function () {\n    this.parentNode.appendChild(this);\n  });\n};\n\nlet array = [];\nexport function launch(data, config) {\n  let getDimensions = () => {\n    config.width = d3.select(`#${config.rootId}`).node().clientWidth, config.innerWidth = d3.select(`#${config.rootId}`).node().clientWidth - config.padding.left - config.padding.right, config.height = d3.select(`#${config.rootId}`).node().clientHeight, config.innerHeight = d3.select(`#${config.rootId}`).node().clientHeight - config.padding.top - config.padding.bottom;\n  };\n\n  let getDoses = () => {\n    return data.lfc.map(d => d.pert_dose).filter(helpers.getUnique);\n  };\n\n  getDimensions();\n  let doses = getDoses();\n  let dimensions = doses.filter(e => e == doses[0] || e == doses[doses.length - 1]);\n  let maxY = data.curve[0].upper_limit; //let minY = data.curve[0].lower_limit;\n\n  /** adds a key for min and max dose. used for filtering data by max/min doses */\n\n  data.curve.forEach(d => {\n    d[`${d.min_dose}`] = d.points[0][1];\n    d[`${d.max_dose}`] = d.points[d.points.length - 1][1];\n  });\n  let plot = d3.select(`#${config.rootId}`).append(\"g\").attr(\"transform\", `translate(${config.padding.left}, ${config.padding.top})`).attr(\"id\", \"plot\");\n  config.scale = {\n    x: d3.scaleLog().domain(d3.extent(doses)).range([0, config.innerWidth]),\n    y: d3.scaleLinear().domain([0, maxY]).range([config.innerHeight, 0])\n  };\n  render(data.curve, config);\n  table(data.curve);\n  const x = d3.axisBottom().scale(config.scale.x).tickValues(doses).tickSizeInner(config.innerHeight);\n  const y = [d3.axisLeft().scale(config.scale.y).tickSize(-config.innerWidth), d3.axisRight().scale(config.scale.y)]; // Set the gradient\n\n  plot.append(\"linearGradient\").attr(\"id\", \"gradient\").attr(\"gradientUnits\", \"userSpaceOnUse\").attr(\"x1\", 0).attr(\"y1\", config.scale.y(maxY)).attr(\"x2\", 0).attr(\"y2\", config.scale.y(0)).selectAll(\"stop\").data([{\n    offset: \"0%\",\n    color: d3.interpolateSpectral(1)\n  }, {\n    offset: \"100%\",\n    color: d3.interpolateSpectral(0)\n  }]).enter().append(\"stop\").attr(\"offset\", function (d) {\n    return d.offset;\n  }).attr(\"stop-color\", function (d) {\n    return d.color;\n  }); // append x axis with non-log tick format..find better way?\n\n  plot.append(\"g\").attr(\"class\", \"axis x-axis\").call(x).selectAll(\"text\").attr(\"dy\", 14).html((d, i) => {\n    return doses[i];\n  });\n  var yAxis = plot.selectAll(\".dimension\").data(dimensions).enter().append(\"g\").attr(\"class\", \"dimension\").attr(\"transform\", d => `translate(${config.scale.x(d)},0)`);\n  yAxis.append(\"g\").attr(\"class\", \"axis\").each(function (d, i) {\n    d3.select(this).call(y[i]);\n  });\n  let brushWidth = 10;\n  let brush = d3.brushY().extent([[-brushWidth, config.scale.y.range()[1]], [brushWidth, config.scale.y.range()[0]]]).on(\"end\", brushed);\n  yAxis.append(\"rect\").attr(\"class\", \"brush-track\").attr(\"x\", -8).attr(\"y\", 0).attr(\"width\", 16).attr(\"height\", config.innerHeight).attr(\"fill\", \"url(#gradient)\"); // Add a brush for each axis.\n\n  yAxis.append(\"g\").attr(\"class\", \"brush\").each(function () {\n    d3.select(this).call(brush);\n  }).selectAll(\"rect\").attr(\"x\", -8).attr(\"width\", 16);\n\n  function brushed() {\n    var actives = [];\n    plot.selectAll(\".brush\").filter(function () {\n      return d3.brushSelection(this);\n    }).each(function (d) {\n      actives.push({\n        dimension: d,\n        extent: d3.brushSelection(this)\n      });\n    });\n    let filtered = data.curve.filter(d => {\n      return actives.every(function (active) {\n        return active.extent[0] <= config.scale.y(d[active.dimension]) && config.scale.y(d[active.dimension]) <= active.extent[1];\n      });\n    });\n    render(filtered, config);\n    renderSelections();\n    table(filtered);\n  }\n}\n\nfunction render(data, config) {\n  let path = d3.line().x(function (d) {\n    return config.scale.x(d[0]);\n  }).y(function (d) {\n    return config.scale.y(d[1]);\n  }).curve(d3.curveBasis);\n  let plot = d3.select(\"#plot\");\n  let paths = plot.selectAll(\".curve\").data(data);\n  paths.exit().remove();\n  paths.enter().append(\"g\").merge(paths).attr(\"class\", \"curve\").each(function (d) {\n    d3.select(this).selectAll(\"path\").remove();\n    d3.select(this).append(\"path\").attr(\"class\", \"path\").attr(\"d\", path(d.points)).attr(\"stroke\", \"url(#gradient)\").attr(\"fill\", \"none\");\n    d3.select(this).selectAll(\"text\").remove();\n    d3.select(this).append(\"text\").attr(\"x\", config.innerWidth + 25).attr(\"y\", config.scale.y(d.points[d.points.length - 1][1])).attr(\"dy\", 6).html(d.ccle_name).attr(\"text-anchor\", \"start\").attr(\"class\", \"label\");\n  }).on(\"click\", function (d, e) {\n    updateSelections(e);\n    renderSelections();\n    /** to handle path classes without using the selections array */\n    // d3.select(this).moveToFront().classed(\"active\", d3.select(this).classed(\"active\") ? false : true);\n    // d3.selectAll(\".active\").classed(\"inactive\", false)\n    // d3.selectAll(\".curve:not(.active)\").classed(\"inactive\", true)\n    // if (!helpers.classExists('active')){\n    //     d3.selectAll(\".inactive\").classed(\"inactive\", false)\n    // }\n  }).on(\"mouseover\", function () {\n    d3.select(this).moveToFront().classed(\"inactive\", false);\n    d3.selectAll(\".active\").moveToFront();\n  }).on(\"mouseleave\", function () {\n    let classes = d3.select(this).attr(\"class\");\n\n    if (classes != \"curve active\") {\n      d3.select(this).classed(\"inactive\", true);\n    }\n  });\n}\n\nfunction table(data) {\n  let dTable = $('#table').DataTable();\n  dTable.clear().rows.add(data).draw();\n  tableEvents();\n}\n\nfunction tableEvents() {\n  //  let dTable = $('#table').DataTable();\n  $('#table tbody').on('click', 'tr', function () {\n    $('tr').removeClass('click');\n    $(this).addClass('click'); // let d = dTable.rows('.click').data().toArray()[0]\n  }).on('mouseover', 'tr', function () {\n    $(this).addClass('mouseover'); // let d = dTable.rows('.mouseover').data().toArray()[0]\n    // console.log(d)\n  }).on('mouseleave', 'tr', function () {\n    $('tr').removeClass('mouseover');\n    d3.selectAll(\"circle.mouseover\").classed(\"mouseover\", false);\n  });\n}\n\nexport function updateSelections(element) {\n  if (element.length == 0) {\n    array = [];\n  } else {\n    if (array.indexOf(element) != -1) {\n      array.splice(array.indexOf(element), 1);\n    } else {\n      array.push(element);\n    }\n  }\n}\nexport function renderSelections() {\n  d3.selectAll(\".active\").classed(\"active\", false);\n  let map = array.map(d => d.ccle_name);\n  d3.selectAll(\".curve\").filter(d => {\n    return map.includes(d.ccle_name);\n  }).moveToFront().classed(\"active\", true);\n  d3.selectAll(\".active\").classed(\"inactive\", false);\n  d3.selectAll(\".curve:not(.active)\").classed(\"inactive\", true);\n\n  if (!helpers.classExists('active')) {\n    d3.selectAll(\".inactive\").classed(\"inactive\", false);\n  }\n}","map":{"version":3,"names":["d3","$","helpers","selection","prototype","moveToFront","each","parentNode","appendChild","array","launch","data","config","getDimensions","width","select","rootId","node","clientWidth","innerWidth","padding","left","right","height","clientHeight","innerHeight","top","bottom","getDoses","lfc","map","d","pert_dose","filter","getUnique","doses","dimensions","e","length","maxY","curve","upper_limit","forEach","min_dose","points","max_dose","plot","append","attr","scale","x","scaleLog","domain","extent","range","y","scaleLinear","render","table","axisBottom","tickValues","tickSizeInner","axisLeft","tickSize","axisRight","selectAll","offset","color","interpolateSpectral","enter","call","html","i","yAxis","brushWidth","brush","brushY","on","brushed","actives","brushSelection","push","dimension","filtered","every","active","renderSelections","path","line","curveBasis","paths","exit","remove","merge","ccle_name","updateSelections","classed","classes","dTable","DataTable","clear","rows","add","draw","tableEvents","removeClass","addClass","element","indexOf","splice","includes","classExists"],"sources":["/Users/liapetronio/Dropbox/Mac/Documents/Github/PRISM-data-portal/src/js/DoseResponse.js"],"sourcesContent":["import * as d3 from 'd3';\nimport * as $ from \"jquery\";\nimport * as helpers from './utils/helpers.js'\n\nd3.selection.prototype.moveToFront = function() {\n    return this.each(function(){\n      this.parentNode.appendChild(this);\n    });\n  };\n\nlet array = [];\nexport function launch(data, config){\n\n    let getDimensions = ()=>{\n        config.width = d3.select(`#${config.rootId}`).node().clientWidth,\n        config.innerWidth = d3.select(`#${config.rootId}`).node().clientWidth - config.padding.left - config.padding.right,\n        config.height = d3.select(`#${config.rootId}`).node().clientHeight,\n        config.innerHeight = d3.select(`#${config.rootId}`).node().clientHeight - config.padding.top - config.padding.bottom;\n    }\n    let getDoses = ()=>{\n        return data.lfc.map(d=>d.pert_dose).filter(helpers.getUnique)\n    }\n\n    getDimensions();\n    let doses = getDoses();\n    let dimensions = doses.filter(e=>e == doses[0] || e == doses[doses.length - 1]);\n\n    let maxY = data.curve[0].upper_limit;\n    //let minY = data.curve[0].lower_limit;\n\n    /** adds a key for min and max dose. used for filtering data by max/min doses */\n    data.curve.forEach(d=>{\n        d[`${d.min_dose}`] =  d.points[0][1]\n        d[`${d.max_dose}`] =  d.points[d.points.length -1][1]\n    })\n\n    let plot = d3.select(`#${config.rootId}`).append(\"g\")\n        .attr(\"transform\",  `translate(${config.padding.left}, ${config.padding.top})`)\n        .attr(\"id\", \"plot\")\n\n    config.scale = {\n        x: d3.scaleLog().domain(d3.extent(doses)).range([0, config.innerWidth]),\n        y: d3.scaleLinear().domain([0, maxY]).range([config.innerHeight, 0])\n    }\n\n\n\n    render(data.curve, config)\n    table(data.curve)\n\n\n    const x = d3.axisBottom()\n        .scale(config.scale.x)\n        .tickValues(doses)\n        .tickSizeInner(config.innerHeight);     \n          \n    const y = [\n            d3.axisLeft()\n                .scale(config.scale.y)\n                .tickSize(-config.innerWidth),\n            d3.axisRight()\n                .scale(config.scale.y)\n    ];\n\n    // Set the gradient\n    plot.append(\"linearGradient\")\n        .attr(\"id\", \"gradient\")\n        .attr(\"gradientUnits\", \"userSpaceOnUse\")\n        .attr(\"x1\", 0)\n        .attr(\"y1\", config.scale.y(maxY))\n        .attr(\"x2\", 0)\n        .attr(\"y2\", config.scale.y(0))\n        .selectAll(\"stop\")\n        .data([\n            {offset: \"0%\", color:d3.interpolateSpectral(1)},\n            {offset: \"100%\", color: d3.interpolateSpectral(0)}\n        ])\n        .enter().append(\"stop\")\n        .attr(\"offset\", function(d) { return d.offset; })\n        .attr(\"stop-color\", function(d) { return d.color; });\n        \n    // append x axis with non-log tick format..find better way?\n    plot.append(\"g\").attr(\"class\", \"axis x-axis\")\n        .call(x)\n        .selectAll(\"text\")\n        .attr(\"dy\", 14)\n        .html((d,i)=>{ return doses[i]})\n\n    var yAxis = plot.selectAll(\".dimension\")\n        .data(dimensions)\n        .enter().append(\"g\")\n        .attr(\"class\", \"dimension\")\n        .attr(\"transform\", d=> `translate(${config.scale.x(d)},0)`)\n\n    yAxis.append(\"g\")\n        .attr(\"class\", \"axis\")\n        .each(function(d,i) { \n            d3.select(this).call(y[i]);          \n        })\n\n    let brushWidth = 10;\n    let brush = d3.brushY()\n        .extent([[-brushWidth, config.scale.y.range()[1]], [brushWidth, config.scale.y.range()[0]]])\n        .on(\"end\", brushed);\n\n    yAxis\n        .append(\"rect\")\n        .attr(\"class\", \"brush-track\")\n        .attr(\"x\", -8)\n        .attr(\"y\", 0)\n        .attr(\"width\", 16)\n        .attr(\"height\", config.innerHeight)\n        .attr(\"fill\", \"url(#gradient)\")\n   // Add a brush for each axis.\n   yAxis\n        .append(\"g\")\n        .attr(\"class\", \"brush\")\n        .each(function() { d3.select(this).call(brush); })\n        .selectAll(\"rect\")\n        .attr(\"x\", -8)\n        .attr(\"width\", 16);\n\n    function brushed() {\n        var actives = [];\n        plot.selectAll(\".brush\")\n            .filter(function() {\n                return d3.brushSelection(this);\n            })\n            .each(function(d) {\n                actives.push({\n                    dimension: d,\n                    extent: d3.brushSelection(this),\n                });\n            });\n           let filtered = data.curve.filter(d=>{\n            return actives.every(function(active) {\n                return active.extent[0] <= config.scale.y(d[active.dimension]) && config.scale.y(d[active.dimension])  <= active.extent[1];\n            })\n           })\n           render(filtered, config)\n           renderSelections()\n           table(filtered)\n      \n    }\n\n}\n\nfunction render(data, config){\n\n    let path = d3.line()\n            .x(function(d) { return config.scale.x(d[0]) })\n            .y(function(d) { return config.scale.y(d[1]) })\n            .curve(d3.curveBasis)\n\n    let plot = d3.select(\"#plot\");\n\n    let paths = plot.selectAll(\".curve\")\n        .data(data)\n    paths.exit().remove()\n\n    paths\n        .enter()\n        .append(\"g\")\n        .merge(paths)\n        .attr(\"class\", \"curve\")\n        .each(function(d){\n            d3.select(this).selectAll(\"path\").remove();\n            d3.select(this).append(\"path\")\n                .attr(\"class\", \"path\")\n                .attr(\"d\", path(d.points))\n                .attr(\"stroke\", \"url(#gradient)\" )\n                .attr(\"fill\", \"none\")\n            d3.select(this).selectAll(\"text\").remove();\n            d3.select(this).append(\"text\")\n                .attr(\"x\", config.innerWidth+25)\n                .attr(\"y\", config.scale.y(d.points[d.points.length-1][1]))\n                .attr(\"dy\", 6)\n                .html(d.ccle_name )\n                .attr(\"text-anchor\", \"start\")\n                .attr(\"class\", \"label\")\n        })\n        .on(\"click\", function(d, e){  \n            updateSelections(e)\n            renderSelections()\n               /** to handle path classes without using the selections array */\n            // d3.select(this).moveToFront().classed(\"active\", d3.select(this).classed(\"active\") ? false : true);\n            // d3.selectAll(\".active\").classed(\"inactive\", false)\n            // d3.selectAll(\".curve:not(.active)\").classed(\"inactive\", true)\n\n            // if (!helpers.classExists('active')){\n            //     d3.selectAll(\".inactive\").classed(\"inactive\", false)\n            // }\n        })\n        .on(\"mouseover\", function(){\n            d3.select(this).moveToFront().classed(\"inactive\", false)\n            d3.selectAll(\".active\").moveToFront()\n        })\n        .on(\"mouseleave\", function(){\n            let classes = d3.select(this).attr(\"class\");\n         \n            if (classes != \"curve active\"){\n                d3.select(this).classed(\"inactive\", true)\n            }\n           \n        })\n}\n\nfunction table(data){\n  let dTable = $('#table').DataTable();\n  dTable.clear().rows.add(data).draw();\n  tableEvents()\n}\n\nfunction tableEvents(){\n  //  let dTable = $('#table').DataTable();\n    $('#table tbody')\n    .on('click', 'tr', function () {\n        $('tr').removeClass('click')\n        $(this).addClass('click')\n        // let d = dTable.rows('.click').data().toArray()[0]\n    })\n    .on('mouseover', 'tr', function () {\n        $(this).addClass('mouseover')\n        // let d = dTable.rows('.mouseover').data().toArray()[0]\n        // console.log(d)\n    })\n    .on('mouseleave', 'tr', function () {\n        $('tr').removeClass('mouseover')\n        d3.selectAll(\"circle.mouseover\").classed(\"mouseover\", false)\n    })\n}\n\n\nexport function updateSelections(element){\n    if (element.length == 0){\n        array = []\n    } else {\n        if (array.indexOf(element) != -1) {\n            array.splice(array.indexOf(element), 1)\n        } else {\n            array.push(element);\n        }\n    }\n}\n\nexport function renderSelections(){\n\n    d3.selectAll(\".active\").classed(\"active\", false)\n\n    let map = array.map(d=>d.ccle_name)\n\n    d3.selectAll(\".curve\").filter(d=> {\n        return map.includes(d.ccle_name)\n    })\n    .moveToFront()\n    .classed(\"active\", true)\n\n    d3.selectAll(\".active\").classed(\"inactive\", false)\n    d3.selectAll(\".curve:not(.active)\").classed(\"inactive\", true)\n\n    if (!helpers.classExists('active')){\n        d3.selectAll(\".inactive\").classed(\"inactive\", false)\n    }\n}\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}