{"ast":null,"code":"import * as d3 from 'd3';\nimport * as $ from \"jquery\"; // import {interpolateYlGn} from \"https://cdn.skypack.dev/d3-scale-chromatic@3\";\n\nd3.selection.prototype.moveToFront = function () {\n  return this.each(function () {\n    this.parentNode.appendChild(this);\n  });\n};\n\nfunction getUnique(value, index, self) {\n  return self.indexOf(value) === index;\n}\n\nfunction classExists(className) {\n  return document.getElementsByClassName(`${className}`).length > 0;\n}\n\nlet array = [];\nexport function launch(data, config) {\n  let getDimensions = () => {\n    config.width = d3.select(`#${config.rootId}`).node().clientWidth, config.innerWidth = d3.select(`#${config.rootId}`).node().clientWidth - config.padding.left - config.padding.right, config.height = d3.select(`#${config.rootId}`).node().clientHeight, config.innerHeight = d3.select(`#${config.rootId}`).node().clientHeight - config.padding.top - config.padding.bottom;\n  };\n\n  let getDoses = () => {\n    return data.lfc.map(d => d.pert_dose).filter(getUnique);\n  };\n\n  getDimensions();\n  let doses = getDoses();\n  let dimensions = doses.filter(e => e == doses[0] || e == doses[doses.length - 1]);\n  let maxY = data.curve[0].upper_limit; //let minY = data.curve[0].lower_limit;\n\n  /** adds a key for min and max dose. used for filtering data by max/min doses */\n\n  data.curve.forEach(d => {\n    d[`${d.min_dose}`] = d.points[0][1];\n    d[`${d.max_dose}`] = d.points[d.points.length - 1][1];\n  });\n  let plot = d3.select(`#${config.rootId}`).append(\"g\").attr(\"transform\", `translate(${config.padding.left}, ${config.padding.right})`).attr(\"id\", \"plot\");\n  config.scale = {\n    x: d3.scaleLog().domain(d3.extent(doses)).range([0, config.innerWidth]),\n    y: d3.scaleLinear().domain([0, maxY]).range([config.innerHeight, 0])\n  };\n  render(data.curve, config);\n  table(data.curve);\n  tableEvents();\n  const x = d3.axisBottom().scale(config.scale.x).tickValues(doses).tickSizeInner(config.innerHeight);\n  const y = [d3.axisLeft().scale(config.scale.y).tickSize(-config.innerWidth), d3.axisRight().scale(config.scale.y)]; // Set the gradient\n\n  plot.append(\"linearGradient\").attr(\"id\", \"gradient\").attr(\"gradientUnits\", \"userSpaceOnUse\").attr(\"x1\", 0).attr(\"y1\", config.scale.y(maxY)).attr(\"x2\", 0).attr(\"y2\", config.scale.y(0)).selectAll(\"stop\").data([{\n    offset: \"0%\",\n    color: d3.interpolateSpectral(1)\n  }, {\n    offset: \"100%\",\n    color: d3.interpolateSpectral(0)\n  }]).enter().append(\"stop\").attr(\"offset\", function (d) {\n    return d.offset;\n  }).attr(\"stop-color\", function (d) {\n    return d.color;\n  }); // append x axis with non-log tick format..find better way?\n\n  plot.append(\"g\").attr(\"class\", \"axis x-axis\").call(x).selectAll(\"text\").attr(\"dy\", 14).html((d, i) => {\n    return doses[i];\n  });\n  var yAxis = plot.selectAll(\".dimension\").data(dimensions).enter().append(\"g\").attr(\"class\", \"dimension\").attr(\"transform\", d => `translate(${config.scale.x(d)},0)`);\n  yAxis.append(\"g\").attr(\"class\", \"axis\").each(function (d, i) {\n    d3.select(this).call(y[i]);\n  });\n  let brushWidth = 10;\n  let brush = d3.brushY().extent([[-brushWidth, config.scale.y.range()[1]], [brushWidth, config.scale.y.range()[0]]]).on(\"end\", brushed);\n  yAxis.append(\"rect\").attr(\"class\", \"brush-track\").attr(\"x\", -8).attr(\"y\", 0).attr(\"width\", 16).attr(\"height\", config.innerHeight).attr(\"fill\", \"url(#gradient)\"); // Add a brush for each axis.\n\n  yAxis.append(\"g\").attr(\"class\", \"brush\").each(function () {\n    d3.select(this).call(brush);\n  }).selectAll(\"rect\").attr(\"x\", -8).attr(\"width\", 16);\n\n  function brushed() {\n    var actives = [];\n    plot.selectAll(\".brush\").filter(function () {\n      return d3.brushSelection(this);\n    }).each(function (d) {\n      actives.push({\n        dimension: d,\n        extent: d3.brushSelection(this)\n      });\n    });\n    let filtered = data.curve.filter(d => {\n      return actives.every(function (active) {\n        return active.extent[0] <= config.scale.y(d[active.dimension]) && config.scale.y(d[active.dimension]) <= active.extent[1];\n      });\n    });\n    render(filtered, config);\n    renderSelections();\n    table(filtered);\n  }\n}\n\nfunction render(data, config) {\n  let path = d3.line().x(function (d) {\n    return config.scale.x(d[0]);\n  }).y(function (d) {\n    return config.scale.y(d[1]);\n  }).curve(d3.curveBasis);\n  let plot = d3.select(\"#plot\");\n  let paths = plot.selectAll(\".curve\").data(data);\n  paths.exit().remove();\n  paths.enter().append(\"g\").merge(paths).attr(\"class\", \"curve\").each(function (d) {\n    d3.select(this).selectAll(\"path\").remove();\n    d3.select(this).append(\"path\").attr(\"class\", \"path\").attr(\"d\", path(d.points)).attr(\"stroke\", \"url(#gradient)\").attr(\"fill\", \"none\");\n    d3.select(this).selectAll(\"text\").remove();\n    d3.select(this).append(\"text\").attr(\"x\", 0).attr(\"y\", config.scale.y(d.points[0][1])).html(d.ccle_name).attr(\"text-anchor\", \"end\").attr(\"class\", \"label\");\n  }).on(\"click\", function (d, e) {\n    updateSelections(e);\n    renderSelections();\n    /** to handle path classes without using the selections array */\n    // d3.select(this).moveToFront().classed(\"active\", d3.select(this).classed(\"active\") ? false : true);\n    // d3.selectAll(\".active\").classed(\"inactive\", false)\n    // d3.selectAll(\".curve:not(.active)\").classed(\"inactive\", true)\n    // if (!classExists('active')){\n    //     d3.selectAll(\".inactive\").classed(\"inactive\", false)\n    // }\n  }).on(\"mouseover\", function () {\n    d3.select(this).moveToFront().classed(\"inactive\", false);\n    d3.selectAll(\".active\").moveToFront();\n  }).on(\"mouseleave\", function () {\n    let classes = d3.select(this).attr(\"class\");\n\n    if (classes != \"curve active\") {\n      d3.select(this).classed(\"inactive\", true);\n    }\n  });\n}\n\nfunction table(data) {\n  let dTable = $('#table').DataTable();\n  dTable.clear().rows.add(data).draw();\n}\n\nfunction tableEvents() {\n  let dTable = $('#table').DataTable();\n  $('#table tbody').on('click', 'tr', function () {\n    $('tr').removeClass('click');\n    $(this).addClass('click');\n    let d = dTable.rows('.click').data().toArray()[0];\n    console.log(d);\n  }).on('mouseover', 'tr', function () {\n    $(this).addClass('mouseover');\n    let d = dTable.rows('.mouseover').data().toArray()[0];\n    console.log(d);\n  }).on('mouseleave', 'tr', function () {\n    $('tr').removeClass('mouseover');\n    d3.selectAll(\"circle.mouseover\").classed(\"mouseover\", false);\n  });\n}\n\nexport function updateSelections(element) {\n  if (element.length == 0) {\n    array = [];\n  } else {\n    if (array.indexOf(element) != -1) {\n      array.splice(array.indexOf(element), 1);\n    } else {\n      array.push(element);\n    }\n  }\n}\nexport function renderSelections() {\n  d3.selectAll(\".active\").classed(\"active\", false);\n  let map = array.map(d => d.ccle_name);\n  d3.selectAll(\".curve\").filter(d => {\n    return map.includes(d.ccle_name);\n  }).moveToFront().classed(\"active\", true);\n  d3.selectAll(\".active\").classed(\"inactive\", false);\n  d3.selectAll(\".curve:not(.active)\").classed(\"inactive\", true);\n\n  if (!classExists('active')) {\n    d3.selectAll(\".inactive\").classed(\"inactive\", false);\n  }\n}","map":{"version":3,"names":["d3","$","selection","prototype","moveToFront","each","parentNode","appendChild","getUnique","value","index","self","indexOf","classExists","className","document","getElementsByClassName","length","array","launch","data","config","getDimensions","width","select","rootId","node","clientWidth","innerWidth","padding","left","right","height","clientHeight","innerHeight","top","bottom","getDoses","lfc","map","d","pert_dose","filter","doses","dimensions","e","maxY","curve","upper_limit","forEach","min_dose","points","max_dose","plot","append","attr","scale","x","scaleLog","domain","extent","range","y","scaleLinear","render","table","tableEvents","axisBottom","tickValues","tickSizeInner","axisLeft","tickSize","axisRight","selectAll","offset","color","interpolateSpectral","enter","call","html","i","yAxis","brushWidth","brush","brushY","on","brushed","actives","brushSelection","push","dimension","filtered","every","active","renderSelections","path","line","curveBasis","paths","exit","remove","merge","ccle_name","updateSelections","classed","classes","dTable","DataTable","clear","rows","add","draw","removeClass","addClass","toArray","console","log","element","splice","includes"],"sources":["/Users/liapetronio/Dropbox/Mac/Documents/Github/PRISM-data-portal/src/js/DoseResponse_v1.js"],"sourcesContent":["import * as d3 from 'd3';\nimport * as $ from \"jquery\";\n// import {interpolateYlGn} from \"https://cdn.skypack.dev/d3-scale-chromatic@3\";\nd3.selection.prototype.moveToFront = function() {\n    return this.each(function(){\n      this.parentNode.appendChild(this);\n    });\n  };\nfunction getUnique(value, index, self) {\n    return self.indexOf(value) === index;\n  }\n\nfunction classExists(className){\n    return document.getElementsByClassName(\n        `${className}`\n       ).length > 0;\n}\nlet array = [];\nexport function launch(data, config){\n\n    let getDimensions = ()=>{\n        config.width = d3.select(`#${config.rootId}`).node().clientWidth,\n        config.innerWidth = d3.select(`#${config.rootId}`).node().clientWidth - config.padding.left - config.padding.right,\n        config.height = d3.select(`#${config.rootId}`).node().clientHeight,\n        config.innerHeight = d3.select(`#${config.rootId}`).node().clientHeight - config.padding.top - config.padding.bottom;\n    }\n    let getDoses = ()=>{\n        return data.lfc.map(d=>d.pert_dose).filter(getUnique)\n    }\n\n    getDimensions();\n    let doses = getDoses();\n    let dimensions = doses.filter(e=>e == doses[0] || e == doses[doses.length - 1]);\n\n    let maxY = data.curve[0].upper_limit;\n    //let minY = data.curve[0].lower_limit;\n\n    /** adds a key for min and max dose. used for filtering data by max/min doses */\n    data.curve.forEach(d=>{\n        d[`${d.min_dose}`] =  d.points[0][1]\n        d[`${d.max_dose}`] =  d.points[d.points.length -1][1]\n    })\n\n    let plot = d3.select(`#${config.rootId}`).append(\"g\")\n        .attr(\"transform\",  `translate(${config.padding.left}, ${config.padding.right})`)\n        .attr(\"id\", \"plot\")\n\n    config.scale = {\n        x: d3.scaleLog().domain(d3.extent(doses)).range([0, config.innerWidth]),\n        y: d3.scaleLinear().domain([0, maxY]).range([config.innerHeight, 0])\n    }\n\n\n\n    render(data.curve, config)\n    table(data.curve)\n    tableEvents()\n\n    const x = d3.axisBottom()\n        .scale(config.scale.x)\n        .tickValues(doses)\n        .tickSizeInner(config.innerHeight);     \n          \n    const y = [\n            d3.axisLeft()\n                .scale(config.scale.y)\n                .tickSize(-config.innerWidth),\n            d3.axisRight()\n                .scale(config.scale.y)\n    ];\n\n    // Set the gradient\n    plot.append(\"linearGradient\")\n        .attr(\"id\", \"gradient\")\n        .attr(\"gradientUnits\", \"userSpaceOnUse\")\n        .attr(\"x1\", 0)\n        .attr(\"y1\", config.scale.y(maxY))\n        .attr(\"x2\", 0)\n        .attr(\"y2\", config.scale.y(0))\n        .selectAll(\"stop\")\n        .data([\n            {offset: \"0%\", color:d3.interpolateSpectral(1)},\n            {offset: \"100%\", color: d3.interpolateSpectral(0)}\n        ])\n        .enter().append(\"stop\")\n        .attr(\"offset\", function(d) { return d.offset; })\n        .attr(\"stop-color\", function(d) { return d.color; });\n        \n    // append x axis with non-log tick format..find better way?\n    plot.append(\"g\").attr(\"class\", \"axis x-axis\")\n        .call(x)\n        .selectAll(\"text\")\n        .attr(\"dy\", 14)\n        .html((d,i)=>{ return doses[i]})\n\n    var yAxis = plot.selectAll(\".dimension\")\n        .data(dimensions)\n        .enter().append(\"g\")\n        .attr(\"class\", \"dimension\")\n        .attr(\"transform\", d=> `translate(${config.scale.x(d)},0)`)\n\n    yAxis.append(\"g\")\n        .attr(\"class\", \"axis\")\n        .each(function(d,i) { \n            d3.select(this).call(y[i]);          \n        })\n\n    let brushWidth = 10;\n    let brush = d3.brushY()\n        .extent([[-brushWidth, config.scale.y.range()[1]], [brushWidth, config.scale.y.range()[0]]])\n        .on(\"end\", brushed);\n\n    yAxis\n        .append(\"rect\")\n        .attr(\"class\", \"brush-track\")\n        .attr(\"x\", -8)\n        .attr(\"y\", 0)\n        .attr(\"width\", 16)\n        .attr(\"height\", config.innerHeight)\n        .attr(\"fill\", \"url(#gradient)\")\n   // Add a brush for each axis.\n   yAxis\n        .append(\"g\")\n        .attr(\"class\", \"brush\")\n        .each(function() { d3.select(this).call(brush); })\n        .selectAll(\"rect\")\n        .attr(\"x\", -8)\n        .attr(\"width\", 16);\n\n    function brushed() {\n        var actives = [];\n        plot.selectAll(\".brush\")\n            .filter(function() {\n                return d3.brushSelection(this);\n            })\n            .each(function(d) {\n                actives.push({\n                    dimension: d,\n                    extent: d3.brushSelection(this),\n                });\n            });\n           let filtered = data.curve.filter(d=>{\n            return actives.every(function(active) {\n                return active.extent[0] <= config.scale.y(d[active.dimension]) && config.scale.y(d[active.dimension])  <= active.extent[1];\n            })\n           })\n           render(filtered, config)\n           renderSelections()\n           table(filtered)\n      \n    }\n\n}\n\nfunction render(data, config){\n\n    let path = d3.line()\n            .x(function(d) { return config.scale.x(d[0]) })\n            .y(function(d) { return config.scale.y(d[1]) })\n            .curve(d3.curveBasis)\n\n    let plot = d3.select(\"#plot\");\n\n    let paths = plot.selectAll(\".curve\")\n        .data(data)\n    paths.exit().remove()\n\n    paths\n        .enter()\n        .append(\"g\")\n        .merge(paths)\n        .attr(\"class\", \"curve\")\n        .each(function(d){\n            d3.select(this).selectAll(\"path\").remove();\n            d3.select(this).append(\"path\")\n                .attr(\"class\", \"path\")\n                .attr(\"d\", path(d.points))\n                .attr(\"stroke\", \"url(#gradient)\" )\n                .attr(\"fill\", \"none\")\n            d3.select(this).selectAll(\"text\").remove();\n            d3.select(this).append(\"text\")\n                .attr(\"x\", 0)\n                .attr(\"y\", config.scale.y(d.points[0][1]))\n                .html(d.ccle_name )\n                .attr(\"text-anchor\", \"end\")\n                .attr(\"class\", \"label\")\n        })\n        .on(\"click\", function(d, e){  \n            updateSelections(e)\n            renderSelections()\n               /** to handle path classes without using the selections array */\n            // d3.select(this).moveToFront().classed(\"active\", d3.select(this).classed(\"active\") ? false : true);\n            // d3.selectAll(\".active\").classed(\"inactive\", false)\n            // d3.selectAll(\".curve:not(.active)\").classed(\"inactive\", true)\n\n            // if (!classExists('active')){\n            //     d3.selectAll(\".inactive\").classed(\"inactive\", false)\n            // }\n        })\n        .on(\"mouseover\", function(){\n            d3.select(this).moveToFront().classed(\"inactive\", false)\n            d3.selectAll(\".active\").moveToFront()\n        })\n        .on(\"mouseleave\", function(){\n            let classes = d3.select(this).attr(\"class\");\n         \n            if (classes != \"curve active\"){\n                d3.select(this).classed(\"inactive\", true)\n            }\n           \n        })\n}\n\nfunction table(data){\n  let dTable = $('#table').DataTable();\n  dTable.clear().rows.add(data).draw();\n}\n\nfunction tableEvents(){\n    let dTable = $('#table').DataTable();\n    $('#table tbody')\n    .on('click', 'tr', function () {\n        $('tr').removeClass('click')\n        $(this).addClass('click')\n        let d = dTable.rows('.click').data().toArray()[0]\n\n     console.log(d)\n    })\n    .on('mouseover', 'tr', function () {\n        $(this).addClass('mouseover')\n        let d = dTable.rows('.mouseover').data().toArray()[0]\n        console.log(d)\n      \n    })\n    .on('mouseleave', 'tr', function () {\n        $('tr').removeClass('mouseover')\n        d3.selectAll(\"circle.mouseover\").classed(\"mouseover\", false)\n    })\n}\n\n\nexport function updateSelections(element){\n    if (element.length == 0){\n        array = []\n    } else {\n        if (array.indexOf(element) != -1) {\n            array.splice(array.indexOf(element), 1)\n        } else {\n            array.push(element);\n        }\n    }\n}\n\nexport function renderSelections(){\n\n    d3.selectAll(\".active\").classed(\"active\", false)\n\n    let map = array.map(d=>d.ccle_name)\n\n    d3.selectAll(\".curve\").filter(d=> {\n        return map.includes(d.ccle_name)\n    })\n    .moveToFront()\n    .classed(\"active\", true)\n\n    d3.selectAll(\".active\").classed(\"inactive\", false)\n    d3.selectAll(\".curve:not(.active)\").classed(\"inactive\", true)\n\n    if (!classExists('active')){\n        d3.selectAll(\".inactive\").classed(\"inactive\", false)\n    }\n}\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}